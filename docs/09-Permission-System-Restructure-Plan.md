# ๐ ุฎุทุฉ ุฅุนุงุฏุฉ ููููุฉ ูุธุงู ุงูุตูุงุญูุงุช
# Permission System Restructure Plan

**ุงููุดุฑูุน:** Telegram Bot Template  
**ุงููุณุฎุฉ:** 1.0.0 - Restructured  
**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-10-02  
**ุงูุญุงูุฉ:** โ ูุนุชูุฏ - ุฌุงูุฒ ููุชูููุฐ

---

## ๐ฏ ุงููุฏู ูู ุฅุนุงุฏุฉ ุงูููููุฉ

ุชุญููู ุงููุธุงู ูู **RBAC ูุนูุฏ (5 ุฃุฏูุงุฑ)** ุฅูู **ูุธุงู ุจุณูุท (3 ุฃุฏูุงุฑ ููุท)** ูุน:
- โ **ูุง ุชุณุฌูู ุชููุงุฆู** - ูู ุทูุจ ุงูุถูุงู ูุญุชุงุฌ ููุงููุฉ super_admin
- โ **ูุงุฌูุฉ ุชุฑุญูุจ ุฐููุฉ** - ุฑุณุงุฆู ูุฎุชููุฉ ููุฒูุงุฑ ูุงููadmins
- โ **ุญูุงูุฉ ูุญููุฉ** - ุงูุฒูุงุฑ ูุฑูู ููุท `/start`ุ ูุง ุดูุก ุขุฎุฑ

---

## ๐ ุงููุธุงู ุงูุญุงูู vs ุงููุธุงู ุงูุฌุฏูุฏ

### ุงููุธุงู ุงูุญุงูู (ุงููุดููุฉ):
```javascript
ROLES = {
  SUPER_ADMIN: 'super_admin',  // ุงููุงูู
  ADMIN: 'admin',              // ูุดุฑู
  MANAGER: 'manager',          // ูุฏูุฑ
  MODERATOR: 'moderator',      // ููุณู
  USER: 'user'                 // ูุณุชุฎุฏู ุนุงุฏู โ๏ธ ุชุณุฌูู ุชููุงุฆู!
}
```

**ุงููุดุงูู:**
- โ ุฃู ุดุฎุต ูุฑุณู `/start` ููุณุฌูู ุชููุงุฆูุงู ูู `user`
- โ 5 ุฃุฏูุงุฑ ูุนูุฏุฉ ูุง ุฏุงุนู ููุง
- โ 9 ูุฆุงุช ุตูุงุญูุงุช ูุซูุฑุฉ ุฌุฏุงู
- โ ูุง ููุฌุฏ ูุธุงู ุทูุจ ุงูุถูุงู

---

### ุงููุธุงู ุงูุฌุฏูุฏ (ุงูุญู):
```javascript
ROLES = {
  SUPER_ADMIN: 'super_admin',  // ุงููุงูู ุงููุญูุฏ (ุตูุงุญูุงุช ูุงููุฉ)
  ADMIN: 'admin',              // ูุดุฑููู ูุนุชูุฏูู ููุท
  VISITOR: 'visitor'           // ุฒูุงุฑ (ูุง ุตูุงุญูุงุช - ุทูุจ ูุนูู)
}
```

**ุงูููุฒุงุช:**
- โ **3 ุฃุฏูุงุฑ ููุท** - ุจุณูุท ููุงุถุญ
- โ **ุทูุจ ุงูุถูุงู ุฅูุฒุงูู** - ูุง ุชุณุฌูู ุชููุงุฆู
- โ **super_admin ููุท ููุงูู** - ุฃูุงู ูุญูู
- โ **ูุงุฌูุงุช ุฐููุฉ** - ุฑุณุงุฆู ูุฎุชููุฉ ููุฒูุงุฑ/admins

---

## ๐ ุณูุฑ ุงูุนูู (User Flow)

### ููุฒุงุฆุฑ ุงูุฌุฏูุฏ (Visitor):

```
1. ุงููุณุชุฎุฏู ูุฑุณู /start
   โ
2. ุงูุจูุช ูุชุญูู: ูู ูุณุฌูุ
   โ ูุง
3. ูุนุฑุถ ุฑุณุงูุฉ ุชุฑุญูุจูุฉ:
   "๐ ูุฑุญุจุงู [ุงูุงุณู]!
   
   ูุฐุง ุงูุจูุช ุฎุงุต ุจุฅุฏุงุฑุฉ ุดุฑูุฉ [ุงุณู ุงูุดุฑูุฉ].
   
   โ๏ธ ููุณ ูุฏูู ุตูุงุญูุงุช ุญุงููุงู.
   
   ๐ ูุทูุจ ุงูุงูุถูุงูุ ุงุถุบุท ุงูุฒุฑ ุฃุฏูุงู:"
   
   [๐ ุทูุจ ุงูุงูุถูุงู]
   โ
4. ูุถุบุท ุงูุฒุฑ โ ูุจุฏุฃ workflow ุงูุชุณุฌูู:
   
   Workflow: join-request
   โโโ Step 1: ุฃุฏุฎู ุงุณูู ุงููุงูู
   โโโ Step 2: ุฃุฏุฎู ุฑูู ููุจุงููู
   โโโ Step 3: ุชุฃููุฏ ุงูุจูุงูุงุช
   โ
5. ุจุนุฏ ุงูุฅุฑุณุงู:
   โ ููุฎุฒู ูู ุฌุฏูู join_requests
   โ ุฅุดุนุงุฑ ููุฑู ููู super_admin
   โ ุฑุณุงูุฉ ูููุณุชุฎุฏู: "ุชู ุฅุฑุณุงู ุทูุจู. ุณูุฑุงุฌุนู ูุฑูุจุงู."
   โ
6. ููุชุธุฑ ููุงููุฉ super_admin
   (ุงูุฏูุฑ: visitor - ูุง ูุณุชุทูุน ูุนู ุดูุก)
```

---

### ููู Super Admin:

```
1. ูุตูู ุฅุดุนุงุฑ ููุฑู:
   "๐ ุทูุจ ุงูุถูุงู ุฌุฏูุฏ
   
   ๐ค ุงูุงุณู: [ุงุณู]
   ๐ฑ ุงูููุจุงูู: [ุฑูู]
   ๐ Telegram ID: [id]
   
   [โ ููุงููุฉ] [โ ุฑูุถ]"
   โ
2. ุฃู ูุฏุฎู ููุญุฉ ุงูุทูุจุงุช:
   /requests
   โ
3. ูุนุฑุถ ุฌููุน ุงูุทูุจุงุช ุงููุนููุฉ:
   
   "๐ ุทูุจุงุช ุงูุงูุถูุงู ุงููุนููุฉ (3)
   
   1๏ธโฃ ุฃุญูุฏ ูุญูุฏ
      ๐ฑ 0123456789
      ๐ ููุฐ ุณุงุนุชูู
      [โ ููุงููุฉ] [โ ุฑูุถ]
   
   2๏ธโฃ ูุงุทูุฉ ุนูู
      ๐ฑ 0987654321
      ๐ ููุฐ 5 ุฏูุงุฆู
      [โ ููุงููุฉ] [โ ุฑูุถ]"
   โ
4. ุนูุฏ ุงูุถุบุท ุนูู [โ ููุงููุฉ]:
   โ ุชุญุฏูุซ ุงูุฏูุฑ: visitor โ admin
   โ ุชุญุฏูุซ join_requests: status = approved
   โ ุฅุดุนุงุฑ ูููุณุชุฎุฏู: "๐ ุชูุช ุงูููุงููุฉ ุนูู ุทูุจู!"
   โ log ุงูุฅุฌุฑุงุก
   โ
5. ุงููุณุชุฎุฏู ูุฑุณู /start ูุฑุฉ ุฃุฎุฑู:
   โ ูุฑู ุงููุงุฆูุฉ ุงููุงููุฉ (admin menu)
```

---

### ููู Admin ุงููุนุชูุฏ:

```
1. ูุฑุณู /start
   โ
2. ุงูุจูุช ูุชุญูู: ูู adminุ
   โ ูุนู
3. ูุนุฑุถ ุฑุณุงูุฉ ุชุฑุญูุจ ูุฎุตุตุฉ:
   "๐ ูุฑุญุจุงู [ุงูุงุณู]!
   
   ๐ ุฃููุงู ุจุนูุฏุชู ุฅูู ููุญุฉ ุงูุชุญูู
   
   ๐ ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ:
   โข ุงููุณุชุฎุฏููู ุงููุดุทูู: 12
   โข ุงูุทูุจุงุช ุงููุนููุฉ: 3
   โข ุขุฎุฑ ูุดุงุท: ููุฐ 5 ุฏูุงุฆู"
   
   [ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ]
   โ
4. ูุณุชุฎุฏู ุฌููุน ุฃูุงูุฑ ุงูุจูุช ุจุญุฑูุฉ
```

---

## ๐ ุงูุชุบููุฑุงุช ุงููุทููุจุฉ

### ุงููููุงุช ุงููุชุฃุซุฑุฉ:

#### 1๏ธโฃ **ูููุงุช ุงูุฅุนุฏุงุฏุงุช** (ุชุนุฏูู)
```
config/permissions.config.js
โโโ ุญุฐู: MANAGER, MODERATOR, USER
โโโ ุฅุถุงูุฉ: VISITOR
โโโ ุชุจุณูุท: ุงูุตูุงุญูุงุช ูู 9 ูุฆุงุช โ 3 ูุฆุงุช ููุท
โโโ ุฅุถุงูุฉ: ุฏุงูุฉ isVisitor()
```

#### 2๏ธโฃ **ุฎุฏูุฉ ุงูุตูุงุญูุงุช** (ุชุนุฏูู + ุฅุถุงูุฉ)
```
src/services/permission.service.js
โโโ ุฅุถุงูุฉ: requestJoin(userId, name, phone)
โโโ ุฅุถุงูุฉ: approveRequest(requestId, adminId)
โโโ ุฅุถุงูุฉ: rejectRequest(requestId, adminId, reason)
โโโ ุฅุถุงูุฉ: getPendingRequests()
โโโ ุชุนุฏูู: getUserRole() โ ุฅุฑุฌุงุน 'visitor' ููุบูุฑ ูุณุฌููู
โโโ ุชุนุฏูู: assignRole() โ ููุน visitor ูู ุชุบููุฑ ุงูุฃุฏูุงุฑ
```

#### 3๏ธโฃ **Middleware ุงูุชุญูู** (ุชุนุฏูู)
```
src/middleware/auth.middleware.js
โโโ ุฅุถุงูุฉ: ูุงุฆูุฉ ุงูุฃูุงูุฑ ุงููุณููุญุฉ ููู visitor: ['/start']
โโโ ุฅุถุงูุฉ: ุฑูุถ ุฃู ุฃูุฑ ุขุฎุฑ ูู visitor
โโโ ุชุนุฏูู: ุฑุณุงูุฉ ุงูุฎุทุฃ: "โ๏ธ ููุณ ูุฏูู ุตูุงุญูุงุช. /start ูุทูุจ ุงูุงูุถูุงู"
```

#### 4๏ธโฃ **ูุนุงูุฌ ุงูุจุฏุงูุฉ** (ุชุนุฏูู ูุงูู)
```
src/handlers/start.handler.js
โโโ ุฅุถุงูุฉ: detectUserRole(userId)
โโโ ุฅุถุงูุฉ: showVisitorWelcome(ctx) โ ุฑุณุงูุฉ + ุฒุฑ ุทูุจ
โโโ ุฅุถุงูุฉ: showAdminWelcome(ctx) โ ุฑุณุงูุฉ ูุฎุตุตุฉ + ูุงุฆูุฉ
โโโ ุชุนุฏูู: handleStart() โ ุชูุฌูู ุฐูู
โโโ ุฅุถุงูุฉ: ุฒุฑ inline "๐ ุทูุจ ุงูุงูุถูุงู"
```

#### 5๏ธโฃ **ูุนุงูุฌ ุทูุจ ุงูุงูุถูุงู** (ุฌุฏูุฏ)
```
src/handlers/join-request.handler.js (ุฌุฏูุฏ - 200 ุณุทุฑ)
โโโ handleJoinRequest() โ ุจุฏุก workflow
โโโ workflow ุงูุชุณุฌูู:
โ   โโโ Step 1: ุทูุจ ุงูุงุณู
โ   โโโ Step 2: ุทูุจ ุฑูู ุงูููุจุงูู
โ   โโโ Step 3: ุชุฃููุฏ ุงูุจูุงูุงุช
โโโ saveJoinRequest() โ ุญูุธ ูู DB
โโโ notifySuperAdmin() โ ุฅุดุนุงุฑ ููุฑู
โโโ sendConfirmation() โ ุฑุณุงูุฉ ูููุณุชุฎุฏู
```

#### 6๏ธโฃ **ูุนุงูุฌ ููุงููุฉ ุงูุทูุจุงุช** (ุฌุฏูุฏ)
```
src/handlers/approve-requests.handler.js (ุฌุฏูุฏ - 250 ุณุทุฑ)
โโโ handleRequestsCommand() โ ุนุฑุถ /requests
โโโ displayPendingRequests() โ ูุงุฆูุฉ ุงูุทูุจุงุช
โโโ handleApprove() โ ููุงููุฉ ุนูู ุทูุจ
โโโ handleReject() โ ุฑูุถ ุทูุจ
โโโ updateRequestStatus() โ ุชุญุฏูุซ ูู DB
โโโ notifyUser() โ ุฅุดุนุงุฑ ุงููุณุชุฎุฏู ุจุงููุชูุฌุฉ
```

#### 7๏ธโฃ **ูุงุนุฏุฉ ุงูุจูุงูุงุช** (ุฌุฏูู ุฌุฏูุฏ)
```
data/database/migrations/add_join_requests_table.sql (ุฌุฏูุฏ)
```

#### 8๏ธโฃ **ุฎุฏูุฉ ุงูุฑุณุงุฆู** (ุชุนุฏูู + ุฅุถุงูุฉ)
```
src/services/message.service.js
โโโ ุฅุถุงูุฉ: getVisitorWelcome()
โโโ ุฅุถุงูุฉ: getAdminWelcome(userName, stats)
โโโ ุฅุถุงูุฉ: getJoinRequestConfirmation()
โโโ ุฅุถุงูุฉ: getApprovalNotification()
โโโ ุฅุถุงูุฉ: getRejectionNotification(reason)
```

#### 9๏ธโฃ **ุงูุชูุซูู** (ุฅุถุงูุฉ)
```
docs/09-Permission-System-Restructure-Plan.md (ูุฐุง ุงูููู)
docs/10-Join-Request-User-Guide.md (ุฏููู ุงููุณุชุฎุฏู)
```

---

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู ุฌุฏูุฏ: `join_requests`

```sql
CREATE TABLE join_requests (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  telegram_id INTEGER NOT NULL,
  username TEXT,
  first_name TEXT,
  last_name TEXT,
  full_name TEXT NOT NULL,           -- ุงูุงุณู ูู ุงููworkflow
  phone TEXT NOT NULL,                -- ุฑูู ุงูููุจุงูู ูู ุงููworkflow
  requested_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  status TEXT DEFAULT 'pending',      -- pending/approved/rejected
  reviewed_by INTEGER,                -- ูุนุฑู ุงููsuper_admin ุงูุฐู ุฑุงุฌุน
  reviewed_at DATETIME,
  rejection_reason TEXT,              -- ุณุจุจ ุงูุฑูุถ (ุงุฎุชูุงุฑู)
  metadata TEXT                       -- JSON ูุฃู ุจูุงูุงุช ุฅุถุงููุฉ
);

-- Indexes
CREATE INDEX idx_join_requests_telegram_id ON join_requests(telegram_id);
CREATE INDEX idx_join_requests_status ON join_requests(status);
CREATE INDEX idx_join_requests_requested_at ON join_requests(requested_at DESC);
```

### ุชุนุฏูู ุฌุฏูู `users`

```sql
-- ุฅุถุงูุฉ ุนููุฏ ููุฅุดุงุฑุฉ ูุทูุจ ุงูุงูุถูุงู
ALTER TABLE users ADD COLUMN join_request_id INTEGER REFERENCES join_requests(id);

-- ุชุญุฏูุซ ุงูุฃุฏูุงุฑ ุงูููุฌูุฏุฉ
UPDATE users SET role = 'admin' WHERE role IN ('manager', 'moderator', 'user');
```

---

## ๐ ููุงุฐุฌ ุงูุฑุณุงุฆู

### 1๏ธโฃ **ุฑุณุงูุฉ ุชุฑุญูุจ ููุฒุงุฆุฑ** (Visitor Welcome)

```markdown
๐ **ูุฑุญุจุงู {first_name}!**

ุฃููุงู ุจู ูู ุจูุช ุฅุฏุงุฑุฉ **[ุงุณู ุงูุดุฑูุฉ/ุงููุดุฑูุน]**

โ๏ธ **ููุณ ูุฏูู ุตูุงุญูุงุช ุญุงููุงู**

ูุฐุง ุงูุจูุช ูุฎุตุต ููุฑูู ุงูุนูู ุงููุนุชูุฏ ููุท.

๐ **ูุทูุจ ุงูุงูุถูุงู:**
ุงุถุบุท ุงูุฒุฑ ุฃุฏูุงู ูุฃููู ุงูุจูุงูุงุช ุงููุทููุจุฉ.
ุณูุฑุงุฌุน ุทูุจู ูู ุฃูุฑุจ ููุช!

[๐ ุทูุจ ุงูุงูุถูุงู ููุดุฑู]
```

---

### 2๏ธโฃ **ุฑุณุงูุฉ ุชุฑุญูุจ ููู Admin** (Admin Welcome)

```markdown
๐ **ูุฑุญุจุงู {full_name}!**

๐ ุฃููุงู ุจุนูุฏุชู ุฅูู ููุญุฉ ุงูุชุญูู

๐ **ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ:**
โข ๐ฅ ุงููุดุฑููู ุงููุดุทูู: {activeAdmins}
โข ๐ ุงูุทูุจุงุช ุงููุนููุฉ: {pendingRequests}
โข ๐ ุขุฎุฑ ูุดุงุท: {lastActivity}

ุงุณุชุฎุฏู ุงููุงุฆูุฉ ุฃุฏูุงู ุฃู ุงูุชุจ ุฃูุฑุงู:

[๐ ุงูุฅุญุตุงุฆูุงุช] [๐ฅ ุงููุณุชุฎุฏููู] [๐ ุงูุทูุจุงุช] [โ๏ธ ุงูุฅุนุฏุงุฏุงุช]
```

---

### 3๏ธโฃ **ุฑุณุงูุฉ ุชุฑุญูุจ ููู Super Admin** (Super Admin Welcome)

```markdown
๐ **ูุฑุญุจุงู {full_name} - ุงููุงูู**

๐ ุฃููุงู ุจู ูู ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ

๐ **ุฅุญุตุงุฆูุงุช ุงููุธุงู:**
โข ๐ฅ ุฅุฌูุงูู ุงููุดุฑููู: {totalAdmins}
โข ๐ ุงูุทูุจุงุช ุงููุนููุฉ: {pendingRequests} ๐
โข ๐ ูุดุงุท ุงูููู: {todayActivity}
โข ๐พ ุญุฌู ูุงุนุฏุฉ ุงูุจูุงูุงุช: {dbSize}

๐ง **ุฃูุงูุฑ ุงููุงูู:**
โข `/requests` - ูุฑุงุฌุนุฉ ุทูุจุงุช ุงูุงูุถูุงู
โข `/users` - ุฅุฏุงุฑุฉ ุงููุดุฑููู
โข `/system` - ุฅุนุฏุงุฏุงุช ุงููุธุงู

[๐ ุงูุทูุจุงุช ({pendingRequests})] [๐ฅ ุงููุดุฑููู] [โ๏ธ ุงููุธุงู] [๐ ุงูุชูุงุฑูุฑ]
```

---

### 4๏ธโฃ **Workflow ุทูุจ ุงูุงูุถูุงู**

#### **Step 1: ุงูุงุณู**
```markdown
๐ **ุทูุจ ุงูุงูุถูุงู - ุงูุฎุทูุฉ 1 ูู 2**

ุงูุฑุฌุงุก ุฅุฏุฎุงู **ุงุณูู ุงููุงูู** ุจุงูุนุฑุจูุฉ:

ูุซุงู: ุฃุญูุฏ ูุญูุฏ ุนูู
```

#### **Step 2: ุฑูู ุงูููุจุงูู**
```markdown
๐ **ุทูุจ ุงูุงูุถูุงู - ุงูุฎุทูุฉ 2 ูู 2**

ุงูุฑุฌุงุก ุฅุฏุฎุงู **ุฑูู ููุจุงููู** (ูุน ููุฏ ุงูุฏููุฉ):

ูุซุงู: +20123456789
ุฃู: 0123456789
```

#### **Step 3: ุงูุชุฃููุฏ**
```markdown
โ **ุชุฃููุฏ ุงูุจูุงูุงุช**

๐ **ุจูุงูุงุชู:**
โข ุงูุงุณู: {full_name}
โข ุงูููุจุงูู: {phone}
โข ูุนุฑู Telegram: @{username}

ูู ุงูุจูุงูุงุช ุตุญูุญุฉุ

[โ ุชุฃููุฏ ุงูุฅุฑุณุงู] [โ ุฅูุบุงุก]
```

#### **ุจุนุฏ ุงูุฅุฑุณุงู**
```markdown
โ **ุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ!**

๐ ุณูุชู ูุฑุงุฌุนุฉ ุทูุจู ูู ูุจู ุงูุฅุฏุงุฑุฉ ูุฑูุจุงู.

โณ **ุงูุฑุฌุงุก ุงูุงูุชุธุงุฑ...**
ุณูุฑุณู ูู ุฅุดุนุงุฑุงู ููุฑ ุงุชุฎุงุฐ ุงููุฑุงุฑ.

ุดูุฑุงู ูุตุจุฑู ๐
```

---

### 5๏ธโฃ **ุฅุดุนุงุฑ ููู Super Admin** (ุทูุจ ุฌุฏูุฏ)

```markdown
๐ **ุทูุจ ุงูุถูุงู ุฌุฏูุฏ!**

๐ค **ุงูุจูุงูุงุช:**
โข ุงูุงุณู: {full_name}
โข ุงูููุจุงูู: {phone}
โข Telegram: @{username} (ID: {telegram_id})
โข ุงูุชุงุฑูุฎ: {requested_at}

[โ ููุงููุฉ] [โ ุฑูุถ]
```

---

### 6๏ธโฃ **ูุงุฆูุฉ ุงูุทูุจุงุช ุงููุนููุฉ** (`/requests`)

```markdown
๐ **ุทูุจุงุช ุงูุงูุถูุงู ุงููุนููุฉ**

ุฅุฌูุงูู ุงูุทูุจุงุช: {count}

โโโโโโโโโโโโโโโโโโโโ

1๏ธโฃ **ุฃุญูุฏ ูุญูุฏ ุนูู**
๐ฑ +20123456789
๐ค @ahmed_mohamed
๐ ููุฐ ุณุงุนุชูู

[โ ููุงููุฉ] [โ ุฑูุถ]

โโโโโโโโโโโโโโโโโโโโ

2๏ธโฃ **ูุงุทูุฉ ุญุณู**
๐ฑ +20987654321
๐ค @fatma_hassan
๐ ููุฐ 5 ุฏูุงุฆู

[โ ููุงููุฉ] [โ ุฑูุถ]

โโโโโโโโโโโโโโโโโโโโ

[๐ ุชุญุฏูุซ] [โ ุฅุบูุงู]
```

---

### 7๏ธโฃ **ุฅุดุนุงุฑ ุงูููุงููุฉ** (ูููุณุชุฎุฏู)

```markdown
๐ **ุชูุช ุงูููุงููุฉ ุนูู ุทูุจู!**

ูุฑุญุจุงู {full_name}ุ

โ ุชู ูุจูู ุทูุจ ุงูุถูุงูู ููุดุฑู ูู ุงูุจูุช.

๐ **ููููู ุงูุขู ุงุณุชุฎุฏุงู ุฌููุน ูููุฒุงุช ุงูุจูุช!**

ุงุถุบุท /start ููุจุฏุก

ูุฑุญุจุงู ุจู ูู ุงููุฑูู! ๐
```

---

### 8๏ธโฃ **ุฅุดุนุงุฑ ุงูุฑูุถ** (ูููุณุชุฎุฏู)

```markdown
โ **ุชู ุฑูุถ ุทูุจ ุงูุงูุถูุงู**

ูุฑุญุจุงู {first_name}ุ

ููุฃุณูุ ูู ูุชู ูุจูู ุทูุจู ุญุงููุงู.

{rejection_reason}

ููููู ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุงุญูุงู.

ุดูุฑุงู ูุชูููู ๐
```

---

## ๐ ูุตูููุฉ ุงูุตูุงุญูุงุช ุงููุจุณุทุฉ

### ุงูุตูุงุญูุงุช ุงููุณููุญุฉ ููู ุฏูุฑ:

| ุงููุธููุฉ | VISITOR | ADMIN | SUPER_ADMIN |
|---------|---------|-------|-------------|
| `/start` | โ | โ | โ |
| `/help` | โ | โ | โ |
| `/menu` | โ | โ | โ |
| `/profile` | โ | โ | โ |
| `/stats` | โ | โ | โ |
| `/users` | โ | โ | โ |
| `/requests` | โ | โ | โ |
| `/system` | โ | โ | โ |
| ุงููุตูู ููุฃูุณุงู | โ | โ | โ |
| ุชูููุฐ Workflows | โ | โ | โ |
| ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช | โ | โ | โ |
| ุทูุจ ุงูุงูุถูุงู | โ | โ | โ |

---

## ๐งช ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ

### โ **Scenario 1: ูุณุชุฎุฏู ุฌุฏูุฏ ูุทูุจ ุงูุงูุถูุงู**

```
1. ูุณุชุฎุฏู ุฌุฏูุฏ (ูุญูุฏ) ูุฑุณู /start
   โ
2. ูุฑู ุฑุณุงูุฉ ุงูุชุฑุญูุจ ููุฒูุงุฑ + ุฒุฑ "ุทูุจ ุงูุงูุถูุงู"
   โ โ ุชููุน: ุฑุณุงูุฉ ุชุฑุญูุจูุฉ ุตุญูุญุฉ + ุฒุฑ ูุงุญุฏ
   โ
3. ูุถุบุท "ุทูุจ ุงูุงูุถูุงู"
   โ
4. ููุทูุจ ููู ุงูุงุณู โ ููุชุจ "ูุญูุฏ ุฃุญูุฏ ุนูู"
   โ โ ุชููุน: ุงูุชุญูู ูู ุงูุงุณู (ุนุฑุจูุ 3-50 ุญุฑู)
   โ
5. ููุทูุจ ููู ุงูููุจุงูู โ ููุชุจ "0123456789"
   โ โ ุชููุน: ุชุทุจูุน ุงูุฑูู ุงูุนุฑุจู
   โ
6. ุดุงุดุฉ ุงูุชุฃููุฏ โ ูุถุบุท "ุชุฃููุฏ"
   โ โ ุชููุน: ุญูุธ ูู join_requests
   โ โ ุชููุน: ุฅุดุนุงุฑ ูููsuper_admin
   โ โ ุชููุน: ุฑุณุงูุฉ ุชุฃููุฏ ูููุณุชุฎุฏู
   โ
7. ูุญุงูู ุฅุฑุณุงู /menu
   โ โ ุชููุน: ุฑูุถ + ุฑุณุงูุฉ "ููุณ ูุฏูู ุตูุงุญูุงุช"
```

---

### โ **Scenario 2: Super Admin ูุฑุงุฌุน ุงูุทูุจุงุช**

```
1. Super Admin ูุฑุณู /requests
   โ
2. ูุฑู ูุงุฆูุฉ ุงูุทูุจุงุช (3 ุทูุจุงุช ูุนููุฉ)
   โ โ ุชููุน: ุนุฑุถ ุฌููุน ุงูุจูุงูุงุช (ุงุณูุ ููุจุงููุ ุชุงุฑูุฎ)
   โ
3. ูุถุบุท "โ ููุงููุฉ" ุนูู ุทูุจ ูุญูุฏ
   โ โ ุชููุน: ุชุญุฏูุซ role ูู users: visitor โ admin
   โ โ ุชููุน: ุชุญุฏูุซ status ูู join_requests: approved
   โ โ ุชููุน: ุฅุดุนุงุฑ ููุฑู ููุญูุฏ
   โ โ ุชููุน: log ุงูุฅุฌุฑุงุก
   โ
4. ูุฑุณู /requests ูุฑุฉ ุฃุฎุฑู
   โ โ ุชููุน: 2 ุทูุจุงุช ููุท (ุชู ุญุฐู ุงููุนุชูุฏ)
```

---

### โ **Scenario 3: Admin ูุนุชูุฏ ูุณุชุฎุฏู ุงูุจูุช**

```
1. ูุญูุฏ (ุจุนุฏ ุงูููุงููุฉ) ูุฑุณู /start
   โ
2. ูุฑู ุฑุณุงูุฉ ุชุฑุญูุจ ูุฎุตุตุฉ + ูุงุฆูุฉ ูุงููุฉ
   โ โ ุชููุน: "ูุฑุญุจุงู ูุญูุฏ ุฃุญูุฏ ุนูู!" + ุฅุญุตุงุฆูุงุช
   โ โ ุชููุน: ุฌููุน ุงูุฃุฒุฑุงุฑ ุธุงูุฑุฉ
   โ
3. ูุฑุณู /menu
   โ โ ุชููุน: ูุงุฆูุฉ ุงูุฃูุณุงู ุงููุงููุฉ
   โ
4. ูุฑุณู /stats
   โ โ ุชููุน: ุฅุญุตุงุฆูุงุช ูุงููุฉ
```

---

### โ **Scenario 4: ุฑูุถ ุทูุจ**

```
1. Super Admin ูุถุบุท "โ ุฑูุถ" ุนูู ุทูุจ ูุงุทูุฉ
   โ
2. ููุทูุจ ููู ุณุจุจ ุงูุฑูุถ (ุงุฎุชูุงุฑู)
   โ ููุชุจ: "ุจูุงูุงุช ุบูุฑ ูุงููุฉ"
   โ
3. ุชุฃููุฏ ุงูุฑูุถ
   โ โ ุชููุน: ุชุญุฏูุซ status: rejected
   โ โ ุชููุน: ุฅุดุนุงุฑ ููุงุทูุฉ ูุน ุงูุณุจุจ
   โ โ ุชููุน: log ุงูุฅุฌุฑุงุก
   โ
4. ูุงุทูุฉ ุชุญุงูู /start
   โ โ ุชููุน: ููุณ ุฑุณุงูุฉ ุงูุฒูุงุฑ (ูููููุง ุฅุนุงุฏุฉ ุงููุญุงููุฉ)
```

---

## ๐ฆ ุงููุฎุฑุฌุงุช ุงูููุงุฆูุฉ

ุจุนุฏ ุงูุชูููุฐุ ุณูุชู ุชุณููู:

### โ **ูููุงุช ุงูููุฏ** (10 ูููุงุช):
```
1. config/permissions.config.js (ูุนุฏูู)
2. src/services/permission.service.js (ูุนุฏูู)
3. src/middleware/auth.middleware.js (ูุนุฏูู)
4. src/handlers/start.handler.js (ูุนุฏูู)
5. src/handlers/join-request.handler.js (ุฌุฏูุฏ)
6. src/handlers/approve-requests.handler.js (ุฌุฏูุฏ)
7. src/services/message.service.js (ูุนุฏูู)
8. data/database/migrations/add_join_requests_table.sql (ุฌุฏูุฏ)
9. workflows/join-request.workflow.json (ุฌุฏูุฏ)
10. src/bot.js (ูุนุฏูู - ุชุณุฌูู ุงูุฃูุงูุฑ)
```

### โ **ูููุงุช ุงูุชูุซูู** (3 ูููุงุช):
```
1. docs/09-Permission-System-Restructure-Plan.md (ูุฐุง ุงูููู)
2. docs/10-Join-Request-User-Guide.md (ุฏููู ุงููุณุชุฎุฏู)
3. docs/03-Progress-Tracker.md (ุชุญุฏูุซ)
```

### โ **ูููุงุช ุงูุงุฎุชุจุงุฑ** (2 ูููุงุช):
```
1. tests/manual/test-join-request.js
2. tests/manual/test-approve-requests.js
```

---

## โฑ๏ธ ุงูุฌุฏูู ุงูุฒููู

### **ุงููุฑุญูุฉ 1: ุงูุชุญุถูุฑ** (30 ุฏูููุฉ)
- โ ูุฑุงุกุฉ ุงูุฎุทุฉ ูุงูููุงููุฉ
- โ ูุณุฎ ุงุญุชูุงุทูุฉ ูู ุงููููุงุช ุงูุญุงููุฉ
- โ ุฅุนุฏุงุฏ branch ุฌุฏูุฏ: `feature/permission-restructure`

### **ุงููุฑุญูุฉ 2: ูุงุนุฏุฉ ุงูุจูุงูุงุช** (15 ุฏูููุฉ)
- โ ุฅูุดุงุก migration: `add_join_requests_table.sql`
- โ ุชูููุฐ Migration
- โ ุงุฎุชุจุงุฑ ุงูุฌุฏูู ุงูุฌุฏูุฏ

### **ุงููุฑุญูุฉ 3: ุงูุฅุนุฏุงุฏุงุช ูุงูุฎุฏูุงุช** (45 ุฏูููุฉ)
- โ ุชุนุฏูู `permissions.config.js`
- โ ุชุนุฏูู `permission.service.js`
- โ ุชุนุฏูู `auth.middleware.js`
- โ ุงุฎุชุจุงุฑ ุงูุฎุฏูุงุช

### **ุงููุฑุญูุฉ 4: ุงููุนุงูุฌุงุช** (90 ุฏูููุฉ)
- โ ุชุนุฏูู `start.handler.js`
- โ ุฅูุดุงุก `join-request.handler.js`
- โ ุฅูุดุงุก `approve-requests.handler.js`
- โ ุชุนุฏูู `message.service.js`
- โ ุฅูุดุงุก workflow: `join-request.workflow.json`

### **ุงููุฑุญูุฉ 5: ุงูุฑุจุท ูุงูุชูุงูู** (30 ุฏูููุฉ)
- โ ุชุณุฌูู ุงูุฃูุงูุฑ ูู `bot.js`
- โ ุฑุจุท ุงููhandlers
- โ ุงุฎุชุจุงุฑ ุงูุชูุงูู

### **ุงููุฑุญูุฉ 6: ุงูุงุฎุชุจุงุฑ** (60 ุฏูููุฉ)
- โ ุงุฎุชุจุงุฑ ุงูุณููุงุฑูููุงุช (4 ุณููุงุฑูููุงุช)
- โ ุงุฎุชุจุงุฑ ุงูุญุงูุงุช ุงูุญุฏูุฉ
- โ ุฅุตูุงุญ ุงูุฃุฎุทุงุก

### **ุงููุฑุญูุฉ 7: ุงูุชูุซูู ูุงููุดุฑ** (30 ุฏูููุฉ)
- โ ุชุญุฏูุซ ุงูุชูุซูู
- โ Commit & Push
- โ Merge ุฅูู main
- โ Tag ุงููุณุฎุฉ: v1.0.0-restructured

**ุฅุฌูุงูู ุงูููุช:** ~5 ุณุงุนุงุช

---

## โ ูุนุงููุฑ ุงููุจูู

### ูุฌุจ ุฃู ูุญูู ุงููุธุงู ุงูุฌุฏูุฏ:

#### **ูุธูููุงู:**
- โ ุงูุฒูุงุฑ ูุฑูู ููุท `/start` + ุฑุณุงูุฉ ุชุฑุญูุจูุฉ + ุฒุฑ ุทูุจ
- โ workflow ุทูุจ ุงูุงูุถูุงู ูุนูู (ุงุณู + ููุจุงูู)
- โ ุญูุธ ุงูุทูุจุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฅุดุนุงุฑ ููุฑู ูููsuper_admin ุนูุฏ ุทูุจ ุฌุฏูุฏ
- โ ุฃูุฑ `/requests` ูุนุฑุถ ุฌููุน ุงูุทูุจุงุช ุงููุนููุฉ
- โ ุงูููุงููุฉ ุชุญูู visitor โ admin
- โ ุงูุฑูุถ ูุณุฌู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุน ุงูุณุจุจ
- โ ุฅุดุนุงุฑุงุช ูููุณุชุฎุฏู (ููุงููุฉ/ุฑูุถ)
- โ Admins ูุฑูู ุฑุณุงูุฉ ุชุฑุญูุจ ูุฎุตุตุฉ + ูุงุฆูุฉ ูุงููุฉ

#### **ุชูููุงู:**
- โ ูุง ุฃุฎุทุงุก ูู Console
- โ ุฌููุน ุงูุฏูุงู ูุฎุชุจุฑุฉ
- โ ุงููุงุด ูุนูู ููุตูุงุญูุงุช
- โ Logs ุดุงููุฉ ูุฌููุน ุงูุฅุฌุฑุงุกุงุช
- โ ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู (ุนุฑุจู)
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ

#### **ุฃูุงูุงู:**
- โ ุงูุฒูุงุฑ ูุง ูููููู ุชูููุฐ ุฃู ุฃูุฑ ูุง ุนุฏุง `/start`
- โ super_admin ููุท ูุฑู `/requests`
- โ ุงูุชุญูู ูู ุงูุจูุงูุงุช (ุงุณูุ ููุจุงูู)
- โ ุญูุงูุฉ ูู duplicate requests
- โ Sanitization ูููุฏุฎูุงุช

---

## ๐ ุงููุฎุงุทุฑ ุงููุญุชููุฉ ูุงูุญููู

### ูุฎุงุทุฑ ูุญุชููุฉ:

#### 1๏ธโฃ **ุชุถุงุฑุจ ูุน ุงููุธุงู ุงูุญุงูู**
- **ุงูุฎุทุฑ:** ูุณุชุฎุฏููู ุญุงูููู ุจุฏูุฑ `user` ุฃู `moderator`
- **ุงูุญู:** migration script ูุญููู ุฌููุน ุงูุฃุฏูุงุฑ ุงููุฏููุฉ ูู `admin`

#### 2๏ธโฃ **cache ูุฏูู**
- **ุงูุฎุทุฑ:** ุตูุงุญูุงุช ูุฏููุฉ ูุญููุธุฉ ูู ุงููุงุด
- **ุงูุญู:** ูุณุญ ุงููุงุด ุงููุงูู ุจุนุฏ ุงูุชุญุฏูุซ

#### 3๏ธโฃ **workflow ูุนูุฏ**
- **ุงูุฎุทุฑ:** ุงููุณุชุฎุฏู ูุฎุฑุฌ ูู ููุชุตู ุงููworkflow
- **ุงูุญู:** ุญูุธ ุงูุญุงูุฉ + ุฅููุงููุฉ ุงุณุชููุงู ูุงุญูุงู

#### 4๏ธโฃ **spam requests**
- **ุงูุฎุทุฑ:** ูุณุชุฎุฏู ูุฑุณู 100 ุทูุจ
- **ุงูุญู:** rate limiting: ุทูุจ ูุงุญุฏ ูู 24 ุณุงุนุฉ

---

## ๐ ุฌูุงุช ุงูุงุชุตุงู

### ูู ุญุงู ุงูุฃุณุฆูุฉ ุฃุซูุงุก ุงูุชูููุฐ:
- **ุงููุทูุฑ ุงููููุฐ:** [ุงุณู]
- **ูุฑุงุฌุน ุงูููุฏ:** [ุงุณู]
- **ุงููุณุคูู ุนู ุงูุงุฎุชุจุงุฑ:** [ุงุณู]

---

## ๐ ููุงุญุธุงุช ููุงุฆูุฉ

### ูุจู ุงูุจุฏุก:
1. โ ูุฑุงุกุฉ ุงูุฎุทุฉ ูุงููุฉ
2. โ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงููุดุฑูุน
3. โ branch ุฌุฏูุฏ ููุชุทููุฑ
4. โ ููุงููุฉ ุตุงุญุจ ุงููุดุฑูุน

### ุฃุซูุงุก ุงูุชูููุฐ:
- โ Commit ุจุนุฏ ูู ุฎุทูุฉ
- โ ุงุฎุชุจุงุฑ ููุฑู ุจุนุฏ ูู ููู
- โ ุชูุซูู ุฃู ุชุบููุฑ ุบูุฑ ูุฎุทุท

### ุจุนุฏ ุงูุงูุชูุงุก:
- โ ุงุฎุชุจุงุฑ ุดุงูู (4 ุณููุงุฑูููุงุช)
- โ ูุฑุงุฌุนุฉ ุงูููุฏ
- โ ุชุญุฏูุซ ุงูุชูุซูู
- โ Merge + Tag

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-10-02  
**ุขุฎุฑ ุชุญุฏูุซ:** 2025-10-02  
**ุงูุญุงูุฉ:** โ ูุนุชูุฏ - ุฌุงูุฒ ููุชูููุฐ

---

*ูุฐุง ุงูููู ููุซู ุงูุฎุทุฉ ุงููุงููุฉ ูุงูููุงุฆูุฉ ูุฅุนุงุฏุฉ ููููุฉ ูุธุงู ุงูุตูุงุญูุงุช*
